{
  "name": "Ruby on Rails Error Rules",
  "description": "Rules for detecting and fixing common Ruby on Rails errors",
  "version": "0.1.0",
  "rules": [
    {
      "id": "rails_record_not_found",
      "pattern": "ActiveRecord::RecordNotFound: Couldn't find ([A-Za-z:]+) with( '?\\w+'? = |ID(\\s+or\\s+\\w+ID)?\\s+).+",
      "type": "ActiveRecord::RecordNotFound",
      "description": "Attempted to find a record that doesn't exist",
      "root_cause": "rails_record_not_found",
      "suggestion": "Use find_by or where methods with appropriate error handling. Consider using find_by_id which returns nil instead of raising an exception.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_record_invalid",
      "pattern": "ActiveRecord::RecordInvalid: Validation failed: (.+)",
      "type": "ActiveRecord::RecordInvalid",
      "description": "Record validation failed during save/create!",
      "root_cause": "rails_record_invalid",
      "suggestion": "Check your model validations. Validate user input before attempting to save. Use save instead of save! or handle the exception.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_routing_error",
      "pattern": "ActionController::RoutingError: No route matches \\[([A-Z]+)\\] \"(.+)\"",
      "type": "ActionController::RoutingError",
      "description": "No route found for the requested URL",
      "root_cause": "rails_routing_error",
      "suggestion": "Check your routes configuration. Ensure the path and HTTP method are correctly defined in config/routes.rb.",
      "confidence": "high",
      "severity": "medium",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_unknown_format",
      "pattern": "ActionController::UnknownFormat",
      "type": "ActionController::UnknownFormat",
      "description": "Controller action doesn't support the requested format",
      "root_cause": "rails_unknown_format",
      "suggestion": "Add respond_to block for the requested format. Check content negotiation in your controller actions.",
      "confidence": "high",
      "severity": "medium",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_param_missing",
      "pattern": "ActionController::ParameterMissing: param(eter)? (required|is missing|not found|missing): (.+)",
      "type": "ActionController::ParameterMissing",
      "description": "Required parameter is missing from the request",
      "root_cause": "rails_parameter_missing",
      "suggestion": "Ensure required parameters are provided in the request. Check your strong parameters configuration.",
      "confidence": "high",
      "severity": "medium",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_template_error",
      "pattern": "ActionView::Template(Error|SyntaxError): (.+)",
      "type": "ActionView::TemplateError",
      "description": "Error in view template",
      "root_cause": "rails_template_error",
      "suggestion": "Check the view template for syntax errors. Ensure variables used in the template are properly initialized.",
      "confidence": "high",
      "severity": "medium",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_missing_template",
      "pattern": "ActionView::MissingTemplate: Missing template (.+)",
      "type": "ActionView::MissingTemplate",
      "description": "View template not found",
      "root_cause": "rails_missing_template",
      "suggestion": "Ensure the template file exists in the correct path. Check controller render calls for typos in template names.",
      "confidence": "high",
      "severity": "medium",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_connection_pool_timeout",
      "pattern": "ActiveRecord::ConnectionTimeoutError: could not obtain a (?:database )?connection within (\\d+\\.?\\d*) seconds",
      "type": "ActiveRecord::ConnectionTimeoutError",
      "description": "Database connection pool exhausted",
      "root_cause": "rails_db_connection_pool_timeout",
      "suggestion": "Increase the connection pool size in database.yml. Ensure connections are properly released after use.",
      "confidence": "high",
      "severity": "high",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_unknown_attribute",
      "pattern": "ActiveRecord::UnknownAttributeError: unknown attribute '([^']+)' for ([A-Za-z:]+)",
      "type": "ActiveRecord::UnknownAttributeError",
      "description": "Attempted to assign to a non-existent attribute",
      "root_cause": "rails_unknown_attribute",
      "suggestion": "Check for typos in attribute names. Ensure you've run migrations to add the column. Use attr_accessor for virtual attributes.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_pending_migration",
      "pattern": "ActiveRecord::PendingMigrationError",
      "type": "ActiveRecord::PendingMigrationError",
      "description": "Database schema has pending migrations",
      "root_cause": "rails_pending_migration",
      "suggestion": "Run `rails db:migrate` to apply pending migrations to your database.",
      "confidence": "high",
      "severity": "high",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_mass_assignment",
      "pattern": "ActiveModel::ForbiddenAttributesError",
      "type": "ActiveModel::ForbiddenAttributesError", 
      "description": "Attempted to use mass assignment without proper parameter filtering",
      "root_cause": "rails_mass_assignment",
      "suggestion": "Use strong parameters to whitelist allowed parameters in your controller.",
      "confidence": "high",
      "severity": "high",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_duplicate_entry_error",
      "pattern": "ActiveRecord::(RecordNotUnique|StatementInvalid):.*(PG::UniqueViolation|duplicate key|UNIQUE constraint failed)",
      "type": "ActiveRecord::RecordNotUnique",
      "description": "Attempted to insert a duplicate record with a unique constraint",
      "root_cause": "rails_duplicate_entry",
      "suggestion": "Add validation for uniqueness in your model, or handle the exception with rescue. Consider using find_or_create_by.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_association_type_mismatch",
      "pattern": "ActiveRecord::AssociationTypeMismatch",
      "type": "ActiveRecord::AssociationTypeMismatch",
      "description": "Attempted to assign an object of the wrong type to an association",
      "root_cause": "rails_association_type_mismatch",
      "suggestion": "Ensure you're assigning the correct model type to the association.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_has_many_through_cannot_associate_new_records",
      "pattern": "ActiveRecord::HasManyThroughCantAssociateNewRecords",
      "type": "ActiveRecord::HasManyThroughCantAssociateNewRecords",
      "description": "Attempted to create a record through a has_many :through association",
      "root_cause": "rails_has_many_through_new_records",
      "suggestion": "Create the join model explicitly instead of using << on the through association.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_csrf_error",
      "pattern": "ActionController::InvalidAuthenticityToken",
      "type": "ActionController::InvalidAuthenticityToken",
      "description": "CSRF token validation failed",
      "root_cause": "rails_csrf_error",
      "suggestion": "Ensure forms include the CSRF token with form_with or form_tag helpers. For AJAX requests, include the token in headers.",
      "confidence": "high",
      "severity": "high",
      "category": "rails",
      "framework": "rails"
    },
    {
      "id": "rails_read_only_record",
      "pattern": "ActiveRecord::ReadOnlyRecord",
      "type": "ActiveRecord::ReadOnlyRecord",
      "description": "Attempted to modify a read-only record",
      "root_cause": "rails_read_only_record",
      "suggestion": "Check if the record was loaded from a readonly query or if it's being updated in an invalid context.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_validation_failed",
      "pattern": "ActiveRecord::RecordInvalid: Validation failed: (.+)",
      "type": "ActiveRecord::RecordInvalid",
      "description": "Model validation failed when saving",
      "root_cause": "rails_validation_failed",
      "suggestion": "Check model validations and ensure data meets requirements. Use valid? or errors.full_messages to debug validation failures.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    },
    {
      "id": "rails_unknown_column",
      "pattern": "ActiveRecord::StatementInvalid:.*column \"([^\"]+)\" does not exist",
      "type": "ActiveRecord::StatementInvalid",
      "description": "Query referenced a column that doesn't exist",
      "root_cause": "rails_unknown_column",
      "suggestion": "Check column names in queries for typos. Ensure migrations have been run to add the column.",
      "confidence": "high",
      "severity": "medium",
      "category": "activerecord",
      "framework": "rails"
    }
  ]
}